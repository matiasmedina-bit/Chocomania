<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chocoman√≠a ¬∑ B-04 Cat√°logo</title>
  <meta name="description" content="Cat√°logo con b√∫squeda, filtros, orden, favoritos y paginaci√≥n.">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --gap:16px; --radius:14px; --shadow:0 8px 24px rgba(0,0,0,.08);
      --bg:#f6f7fb; --card:#ffffff; --ink:#111827; --muted:#6b7280; --brand:#7d3c98; --border:#e5e7eb; --accent:#a66cc4;
      --ok:#10b981; --warn:#f59e0b; --err:#ef4444;
      /* altura uniforme de miniaturas (ajusta si quieres) */
      --thumb-h: clamp(150px, 22vw, 190px);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
    a{color:var(--brand); text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:1140px; margin:0 auto; padding:20px}

    header.top{position:sticky; top:0; z-index:30; backdrop-filter:saturate(180%) blur(8px); background:rgba(246,247,251,.86); border-bottom:1px solid var(--border)}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700; font-size:1.15rem}
    .logo{width:36px; height:36px; border-radius:10px; background:linear-gradient(135deg,#522a7a,#aa6bc8); box-shadow:inset 0 0 0 2px rgba(255,255,255,.25)}
    nav ul{display:flex; gap:14px; list-style:none; margin:0; padding:0}
    nav a{padding:8px 12px; border-radius:999px}
    nav a:hover{background:#ece7f6}
    .btn{border:1px solid var(--border); background:#fff; border-radius:999px; padding:10px 14px; cursor:pointer}
    .btn.primary{background:var(--brand); color:#fff; border-color:transparent}

    .layout{display:grid; grid-template-columns: 260px 1fr; gap:20px; margin-top:18px}
    @media (max-width: 920px){ .layout{ grid-template-columns:1fr } }

    .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow)}
    .muted{color:var(--muted)}

    /* Sidebar filtros */
    .filters h3{margin-top:0}
    .filters ul{list-style:none; margin:8px 0 0 0; padding:0; display:flex; flex-direction:column; gap:8px}
    .filters label{display:flex; align-items:center; gap:8px}
    .range{display:flex; gap:8px; align-items:center}
    input[type="number"], input[type="search"], select{padding:10px 12px; border:1px solid #d1d5db; border-radius:10px; background:#fafafa}

    /* Contenido */
    .controls{display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:14px}
    .controls .grow{flex:1 1 260px}
    .grid-products{display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr))}

    .p-card{border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; display:flex; flex-direction:column; background:#fff}

    /* MINIATURA: altura fija, recorte uniforme */
    .p-thumb{
      position:relative;
      width:100%;
      height:var(--thumb-h);
      background:#faf7ff;
      overflow:hidden;
      display:grid; place-items:center;
    }
    .p-thumb img{
      width:100%; height:100%;
      object-fit:cover; object-position:center;
      display:block; /* evita espacios fantasmas */
    }

    .badges{position:absolute; top:8px; left:8px; display:flex; gap:6px; pointer-events:none}
    .badge{background:#111827; color:#fff; font-size:.75rem; padding:4px 8px; border-radius:999px}
    .badge.sale{background:#8b5cf6}
    .badge.stock{background:#059669}
    .p-body{padding:12px; display:flex; flex-direction:column; gap:8px}
    .p-name{font-weight:600}
    .p-price{display:flex; align-items:baseline; gap:8px}
    .old{color:#6b7280; text-decoration:line-through; font-size:.9rem}
    .actions{display:flex; gap:8px; align-items:center; margin-top:auto}
    .qty{display:flex; align-items:center; gap:6px}
    .icon-btn{border:1px solid var(--border); background:#fff; border-radius:10px; padding:8px 10px; cursor:pointer}
    .fav.active{background:#f3e8ff}

    .empty{padding:24px; border:1px dashed #bbb; border-radius:10px; text-align:center; color:#555}

    .paginator{display:flex; justify-content:center; gap:6px; margin-top:14px}
    .page{border:1px solid var(--border); background:#fff; border-radius:10px; padding:8px 12px; cursor:pointer}
    .page.active{background:var(--brand); color:#fff; border-color:transparent}

    /* Toast */
    .toast-wrap{position:fixed; top:18px; right:18px; display:grid; gap:10px; z-index:50}
    .toast{background:#111827; color:#fff; padding:12px 14px; border-radius:12px; box-shadow:var(--shadow); opacity:0; transform:translateY(-10px); transition:.25s}
    .toast.show{opacity:1; transform:translateY(0)}
  </style>
</head>
<body>
  <header class="top">
    <div class="container topbar">
      <div class="brand"><div class="logo" aria-hidden="true"></div> Chocoman√≠a</div>
      <nav aria-label="principal">
        <ul>
          <li><a href="Visualizaci√≥n Catalogo.html" aria-current="page">Cat√°logo</a></li>
          <li><a href="Promociones.html">Ofertas</a></li>
          <li><a href="Armado.html">Carrito</a></li>
          <li><a href="Acesso Usuarios.html">Ingresar</a></li>
        </ul>
      </nav>
      <button class="btn primary" type="button" id="verPromos">Ver promociones</button>
    </div>
  </header>

  <main class="container layout">
    <!-- Sidebar filtros -->
    <aside class="card filters">
      <h3>Filtros</h3>
      <div>
        <strong>Categor√≠as</strong>
        <ul>
          <li><label><input type="checkbox" name="cat" value="Chocolates" checked> Chocolates</label></li>
          <li><label><input type="checkbox" name="cat" value="Bombones" checked> Bombones</label></li>
          <li><label><input type="checkbox" name="cat" value="Trufas" checked> Trufas</label></li>
          <li><label><input type="checkbox" name="cat" value="Brownies" checked> Brownies</label></li>
        </ul>
      </div>
      <hr>
      <div class="range"><strong>Precio</strong></div>
      <div class="range">
        <input id="min" type="number" placeholder="M√≠n" min="0" class="grow">
        <input id="max" type="number" placeholder="M√°x" min="0" class="grow">
      </div>
      <hr>
      <div>
        <strong>Orden</strong>
        <select id="sort">
          <option value="priceAsc">Precio: ascendente</option>
          <option value="priceDesc">Precio: descendente</option>
          <option value="nameAsc">Nombre: A‚ÜíZ</option>
          <option value="nameDesc">Nombre: Z‚ÜíA</option>
        </select>
      </div>
      <p class="muted">Paginaci√≥n para 12 √≠tems/p√°gina.</p>
    </aside>

    <!-- Contenido -->
    <section class="card">
      <div class="controls">
        <input id="q" class="grow" type="search" placeholder="Buscar producto‚Ä¶" aria-label="Buscar producto">
        <select id="quickCat" aria-label="Categor√≠as">
          <option value="">Todas</option>
          <option>Chocolates</option>
          <option>Bombones</option>
          <option>Trufas</option>
          <option>Brownies</option>
        </select>
        <button class="icon-btn" type="button" id="btnCarrito" title="Ver carrito">üõí <span id="cartCount">0</span></button>
        <button class="icon-btn fav" type="button" id="btnFavs" title="Ver favoritos">‚≠ê</button>
      </div>

      <div id="grid" class="grid-products" aria-live="polite"></div>
      <div id="empty" class="empty" style="display:none">No se encontraron productos disponibles‚Ä¶</div>
      <div id="paginator" class="paginator"></div>
    </section>
  </main>

  <div class="toast-wrap" aria-live="polite" aria-atomic="true"></div>

  <footer class="container" style="margin:18px auto 24px; color:var(--muted); text-align:center">
    ¬© <span id="year"></span> Chocoman√≠a ¬∑ Cat√°logo de delicias üç´
  </footer>

  <script>
    const PRODUCTS = [
      {id:'p01', name:'Chocolate barra',              price:3000, category:'Chocolates', stock:20, img:'IMG/chocobarra.png',      sale:false},
      {id:'p02', name:'Bombones surtidos',            price:4500, category:'Bombones',   stock:20, img:'IMG/BombonesSurt.png',    sale:false},
      {id:'p03', name:'Trufa de cacao',               price:2500, category:'Trufas',     stock:20, img:'IMG/Trufasamar.jpg',     sale:false},
      {id:'p04', name:'Chocolate con almendras',      price:3500, category:'Chocolates', stock:20, img:'IMG/chocoalmendra.png',   sale:false},
      {id:'p05', name:'Galletas con chocolate',       price:3000, category:'Chocolates', stock:20, img:'IMG/gallechoco.png',      sale:false},
      {id:'p06', name:'Chocolate barra sin azucar',   price:4000, category:'Chocolates', stock:20, img:'IMG/chocosin.png',        sale:false},
      {id:'p07', name:'Chocolate caliente',           price:3500, category:'Chocolates', stock:20, img:'IMG/chococalie.png',      sale:false},
      {id:'p08', name:'Frutillas con chocolate',      price:3000, category:'Chocolates', stock:20, img:'IMG/chococonfru.png',     sale:false},
      {id:'p09', name:'Chocolate amargo 70%',         price:4500, category:'Chocolates', stock:20, img:'IMG/chocoamar.png',       sale:false},
      {id:'p10', name:'Brownie chocolate',            price:2500, category:'Brownies',   stock:20, img:'IMG/brownie.png',         sale:false},
      {id:'p11', name:'Chocolate Dubai',              price:5000, category:'Chocolates', stock:20, img:'IMG/ChocoDubai.png',      sale:false},
      {id:'p12', name:'Trufa clasica',                price:2000, category:'Trufas',     stock:20, img:'IMG/trufa.png',           sale:false}
    ];

    const PAGE_SIZE = 12;
    const LS_CART = 'choco_cart';
    const LS_FAVS = 'choco_favs';

    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const paginator = document.getElementById('paginator');
    const q = document.getElementById('q');
    const quickCat = document.getElementById('quickCat');
    const min = document.getElementById('min');
    const max = document.getElementById('max');
    const sortSel = document.getElementById('sort');
    const cartCount = document.getElementById('cartCount');
    const toastWrap = document.querySelector('.toast-wrap');

    function toast(msg){
      const t = document.createElement('div'); t.className='toast'; t.textContent=msg; toastWrap.appendChild(t);
      requestAnimationFrame(()=> t.classList.add('show'));
      setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.remove(), 200); }, 2600);
    }
    function currency(n){ return n.toLocaleString('es-CL', {style:'currency', currency:'CLP', maximumFractionDigits:0}); }
    function getCart(){ try{return JSON.parse(localStorage.getItem(LS_CART))||{};}catch{return{}} }
    function setCart(c){ localStorage.setItem(LS_CART, JSON.stringify(c)); updateCartCount(); }
    function updateCartCount(){ const c = getCart(); cartCount.textContent = Object.values(c).reduce((a,b)=>a+b,0); }
    function getFavs(){ try{return new Set(JSON.parse(localStorage.getItem(LS_FAVS))||[]);}catch{return new Set()} }
    function setFavs(s){ localStorage.setItem(LS_FAVS, JSON.stringify([...s])); }
    function collectCats(){ return [...document.querySelectorAll('input[name="cat"]:checked')].map(i=>i.value); }

    function applyFilters(){
      const text = q.value.trim().toLowerCase();
      const cats = new Set(quickCat.value ? [quickCat.value] : collectCats());
      const minP = Number(min.value||0); const maxP = Number(max.value||Infinity);
      let arr = PRODUCTS.filter(p=> (
        (!text || p.name.toLowerCase().includes(text)) &&
        (!cats.size || cats.has(p.category)) &&
        (p.price >= minP) && (p.price <= maxP)
      ));
      const sort = sortSel.value;
      arr.sort((a,b)=> sort==='priceAsc'? a.price-b.price :
                        sort==='priceDesc'? b.price-a.price :
                        sort==='nameAsc'? a.name.localeCompare(b.name) :
                        b.name.localeCompare(a.name));
      return arr;
    }

    function render(products, page=1){
      grid.innerHTML = ''; paginator.innerHTML='';
      const favs = getFavs();

      if(products.length===0){ empty.style.display='block'; return; }
      empty.style.display='none';

      const totalPages = Math.max(1, Math.ceil(products.length / PAGE_SIZE));
      page = Math.min(page, totalPages);
      const start = (page-1)*PAGE_SIZE; const slice = products.slice(start, start+PAGE_SIZE);

      slice.forEach(p=>{
        const card = document.createElement('article'); card.className='p-card';
        const thumb = document.createElement('div'); thumb.className='p-thumb';
        if(p.img){
          const img = document.createElement('img'); img.alt = p.name; img.src = p.img; thumb.appendChild(img);
        }else{
          thumb.innerHTML = '<span style="color:#8f6aa6;font-weight:600">Sube tu imagen aqu√≠</span>';
        }

        const badges = document.createElement('div'); badges.className='badges';
        const b2 = document.createElement('span'); b2.className='badge stock'; b2.textContent = p.stock>0? 'En stock':'Sin stock'; badges.appendChild(b2);
        thumb.appendChild(badges);

        const body = document.createElement('div'); body.className='p-body';
        const name = document.createElement('div'); name.className='p-name'; name.textContent = p.name;
        const price = document.createElement('div'); price.className='p-price';
        const cur = document.createElement('strong'); cur.textContent = currency(p.price); price.appendChild(cur);

        const act = document.createElement('div'); act.className='actions';
        const qty = document.createElement('div'); qty.className='qty';
        const minus = document.createElement('button'); minus.className='icon-btn'; minus.type='button'; minus.textContent='‚àí';
        const plus = document.createElement('button'); plus.className='icon-btn'; plus.type='button'; plus.textContent='+';
        const qtyVal = document.createElement('span'); qtyVal.textContent='1'; let qv=1;
        minus.addEventListener('click', ()=>{ qv=Math.max(1,qv-1); qtyVal.textContent=qv; });
        plus.addEventListener('click', ()=>{ qv=Math.min(99,qv+1); qtyVal.textContent=qv; });
        qty.append(minus, qtyVal, plus);

        const add = document.createElement('button'); add.className='btn primary'; add.type='button'; add.textContent='Agregar';
        add.addEventListener('click', ()=>{
          if(p.stock<=0){ toast('No hay stock disponible.'); return; }
          const cart = getCart(); cart[p.id] = (cart[p.id]||0) + qv; setCart(cart); toast('Agregado al carrito üõí');
        });

        const fav = document.createElement('button'); fav.className='icon-btn fav'; fav.type='button'; fav.textContent='‚≠ê';
        if(favs.has(p.id)) fav.classList.add('active');
        fav.addEventListener('click', ()=>{
          const set = getFavs();
          if(set.has(p.id)) { set.delete(p.id); fav.classList.remove('active'); toast('Quitado de favoritos'); }
          else { set.add(p.id); fav.classList.add('active'); toast('A√±adido a favoritos'); }
          setFavs(set);
        });

        act.append(qty, add, fav);
        body.append(name, price, act);
        card.append(thumb, body);
        grid.appendChild(card);
      });

      for(let i=1;i<=totalPages;i++){
        const b = document.createElement('button'); b.className='page'+(i===page?' active':''); b.textContent=i; b.addEventListener('click', ()=> render(products, i)); paginator.appendChild(b);
      }
    }

    function refresh(){ render(applyFilters(), 1); }
    q.addEventListener('input', ()=> refresh());
    quickCat.addEventListener('change', ()=> refresh());
    document.querySelectorAll('input[name="cat"]').forEach(c=> c.addEventListener('change', ()=> refresh()));
    min.addEventListener('input', ()=> refresh());
    max.addEventListener('input', ()=> refresh());
    sortSel.addEventListener('change', ()=> refresh());

    document.getElementById('btnFavs').addEventListener('click', ()=>{
      const favs = getFavs();
      const filtered = applyFilters().filter(p=> favs.has(p.id));
      if(filtered.length===0){ toast('No tienes favoritos que coincidan con los filtros.'); }
      render(filtered, 1);
    });

    document.getElementById('btnCarrito').addEventListener('click', ()=> toast('Abrir modal de carrito (demo)'));
    document.getElementById('verPromos').addEventListener('click', ()=>{
      q.value=''; quickCat.value=''; min.value=''; max.value=''; sortSel.value='priceAsc';
      const promo = applyFilters().filter(p=> p.sale);
      if(promo.length===0){ toast('No hay promociones disponibles.'); }
      render(promo, 1);
    });

    updateCartCount();
    refresh();
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
