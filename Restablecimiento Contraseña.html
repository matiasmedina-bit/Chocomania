<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chocomanía · B-03 Recuperar contraseña</title>
  <meta name="description" content="Recuperación y cambio de contraseña con token de 10 minutos.">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --gap:16px; --radius:14px; --shadow:0 8px 24px rgba(0,0,0,.08);
      --bg:#f6f7fb; --card:#ffffff; --ink:#111827; --muted:#6b7280; --brand:#7d3c98; --border:#e5e7eb;
      --ok:#10b981; --warn:#f59e0b; --err:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
    a{color:var(--brand); text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:1140px; margin:0 auto; padding:20px}

    /* Header */
    header.top{position:sticky; top:0; z-index:30; backdrop-filter:saturate(180%) blur(8px); background:rgba(246,247,251,.86); border-bottom:1px solid var(--border)}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700; font-size:1.15rem}
    .logo{width:36px; height:36px; border-radius:10px; background:linear-gradient(135deg,#522a7a,#aa6bc8); box-shadow:inset 0 0 0 2px rgba(255,255,255,.25)}
    nav ul{display:flex; gap:14px; list-style:none; margin:0; padding:0}
    nav a{padding:8px 12px; border-radius:999px}
    nav a:hover{background:#ece7f6}
    .btn{border:1px solid var(--border); background:#fff; border-radius:999px; padding:10px 14px; cursor:pointer}
    .btn.primary{background:var(--brand); color:#fff; border-color:transparent}

    /* Hero */
    .hero{display:grid; grid-template-columns:1.05fr .95fr; gap:20px; align-items:center; margin-top:18px}
    @media (max-width: 900px){ .hero{grid-template-columns:1fr} .grid{grid-template-columns:1fr} }
    .panel{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px}
    .chip{display:inline-flex; gap:8px; align-items:center; font-size:.8rem; color:#6a5a75; background:#f3eafc; border:1px dashed #d2b9eb; padding:6px 10px; border-radius:999px}
    .hero-visual{min-height:220px; border-radius:var(--radius); position:relative; overflow:hidden; display:grid; place-items:center}
    .hero-visual::before{
      content:''; position:absolute; inset:0;
      background:
        radial-gradient(1000px 360px at 0% 0%, rgba(125,60,152,.16), transparent 60%),
        radial-gradient(900px 280px at 100% 90%, rgba(166,108,196,.12), transparent 60%),
        linear-gradient(120deg, rgba(255,255,255,.85), rgba(255,255,255,.6));
    }
    .hero-visual .img-slot{
      width:86%;
      max-width:520px;
      aspect-ratio:1/1;               
      border-radius:18px;
      overflow:hidden;                 
      background:#fff;
      border:2px solid #ece3f6;
      box-shadow:var(--shadow);
      display:block;
    }
    .hero-visual .img-slot img{
      width:100%; height:100%;
      display:block;
      object-fit:cover;               
      object-position:center;         
      border-radius:inherit;
    }

    /* Main grid */
    .grid{display:grid; grid-template-columns:1.05fr .95fr; gap:20px; margin-top:20px}
    .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow)}
    .muted{color:var(--muted)}

    /* Form */
    form.form{display:flex; flex-direction:column; gap:14px}
    .field{display:flex; flex-direction:column; gap:6px}
    .control{display:flex; align-items:center; gap:8px}
    input[type="email"], input[type="password"], input[type="text"]{width:100%; padding:12px 12px; border:1px solid #d1d5db; border-radius:10px; background:#fafafa; outline:none}
    input:focus{border-color:#b48ad3; box-shadow:0 0 0 4px rgba(125,60,152,.12)}
    .hint{font-size:.85rem; color:var(--muted)}
    .error{font-size:.85rem; color:var(--err); display:none}
    .actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap}

    /* Meter */
    .meter{height:8px; background:#eef2ff; border-radius:999px; overflow:hidden; border:1px solid #e5e7eb}
    .meter > i{display:block; height:100%; width:0%; transition:width .35s ease}
    .weak{background:var(--err)} .mid{background:var(--warn)} .strong{background:var(--ok)}

    /* Estados */
    .estados{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:14px}
    .estado{border:1px dashed #c7b5d9; padding:14px; border-radius:12px; background:#fdfbff}
    .badge{display:inline-flex; align-items:center; gap:6px; border-radius:999px; padding:4px 10px; font-size:.8rem; border:1px solid #e5e7eb}

    /* Toast */
    .toast-wrap{position:fixed; top:18px; right:18px; display:grid; gap:10px; z-index:50}
    .toast{background:#111827; color:#fff; padding:12px 14px; border-radius:12px; box-shadow:var(--shadow); opacity:0; transform:translateY(-10px); transition:.25s}
    .toast.show{opacity:1; transform:translateY(0)}

    footer{margin:40px 0 20px; color:var(--muted); text-align:center}
  </style>
</head>
<body>
  <header class="top">
    <div class="container topbar">
      <div class="brand"><div class="logo" aria-hidden="true"></div> Chocomanía</div>
      <nav aria-label="principal">
        <ul>
          <li><a href="Visualización Catalogo.html">Catálogo</a></li>
          <li><a href="Promociones.html">Ofertas</a></li>
          <li><a href="Armado.html">Carrito</a></li>
          <li><a href="Acesso Usuarios.html">Ingresar</a></li>
        </ul>
      </nav>
      <button class="btn primary" type="button">Ver promociones</button>
    </div>
  </header>

  <div class="container hero">
    <div class="panel">
      <h1>¿Olvidaste tu contraseña?</h1>
      <p class="muted">Te enviamos un enlace válido por <strong>10 minutos</strong>. Luego podrás crear una nueva contraseña segura.</p>
      <div class="badge" id="badgeToken">Token: sin generar</div>
    </div>
    <div class="hero-visual panel" aria-label="Espacio para imagen">
      <div class="img-slot">
        <img src="IMG/Correos.png" alt="Correo de recuperación" loading="lazy" decoding="async">
      </div>
    </div>
  </div>

  <main class="container grid" id="recuperar">
    <!-- IZQ: Solicitud de recuperación -->
    <section class="card" aria-labelledby="t-form1">
      <h2 id="t-form1">Solicitar enlace de recuperación</h2>
      <form class="form" id="formSolicitud" novalidate>
        <div class="field">
          <label for="email" class="label">Correo electrónico</label>
          <input id="email" name="email" type="email" placeholder="marcela@example.com" required />
          <span class="error" data-error-for="email">Ingresa un correo válido.</span>
        </div>
        <div class="actions">
          <button class="btn primary" type="submit" id="btnEnviar">Enviar enlace</button>
          <button class="btn" type="reset">Limpiar</button>
        </div>
      </form>
      <p class="muted">Se simula el envío de correo y se guarda un token en tu navegador.</p>
    </section>

    <!-- DER: Estados y flujo -->
    <aside class="card" aria-labelledby="t-estados">
      <h2 id="t-estados">Estados & pasos</h2>
      <div class="estados">
        <div class="estado">
          <h3>Enlace enviado</h3>
          <p>“Se ha enviado un enlace con duración de 10 minutos”.</p>
          <div class="actions">
            <button class="btn" type="button" id="simEnviado">Aceptar</button>
          </div>
        </div>
        <div class="estado">
          <h3>Correo recibido</h3>
          <p>Link para recuperar su contraseña:</p>
          <div class="actions">
            <button class="btn" type="button" id="abrirEnlace">Abrir enlace</button>
            <button class="btn" type="button" id="cancelarCorreo">Cancelar</button>
          </div>
        </div>
        <div class="estado">
          <h3>Enlace expirado</h3>
          <p>“El enlace ha expirado, solicítelo nuevamente”.</p>
          <div class="actions">
            <button class="btn" type="button" id="reenviar">Reenviar</button>
          </div>
        </div>
        
        <!-- Formulario de cambio de contraseña -->
        <div class="estado">
          <h3>Cambiar contraseña</h3>
          <form class="form" id="formCambio" novalidate>
            <div class="field">
              <label for="pass1" class="label">Nueva contraseña</label>
              <input id="pass1" type="password" placeholder="********" required aria-describedby="passReq" />
              <div class="meter" aria-hidden="true"><i id="meterBar"></i></div>
              <div id="passReq" class="hint">Mínimo 8 caracteres, 1 mayúscula y 1 dígito.</div>
              <span class="error" data-error-for="pass1">La contraseña no cumple los requisitos.</span>
            </div>
            <div class="field">
              <label for="pass2" class="label">Repetir contraseña</label>
              <input id="pass2" type="password" placeholder="********" required />
              <span class="error" data-error-for="pass2">Las contraseñas no coinciden.</span>
            </div>
            <div class="actions">
              <button class="btn primary" type="submit" id="btnCambiar">Cambiar contraseña</button>
            </div>
          </form>
        </div>

        <!-- Éxito -->
        <div class="estado">
          <h3>Cambio exitoso</h3>
          <p>“La contraseña ha sido cambiada con éxito”.</p>
          <div class="actions">
            <button class="btn" type="button" id="volverLogin">Volver a Ingresar</button>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <div class="toast-wrap" aria-live="polite" aria-atomic="true"></div>

  <footer>
    <div class="container">© <span id="year"></span> Chocomanía · Recuperación segura</div>
  </footer>

  <script>
    const LS_KEY_REC = 'chocomania_reset';
    const TOKEN_MIN = 10;

    const formSolicitud = document.getElementById('formSolicitud');
    const email = document.getElementById('email');
    const btnEnviar = document.getElementById('btnEnviar');
    const formCambio = document.getElementById('formCambio');
    const pass1 = document.getElementById('pass1');
    const pass2 = document.getElementById('pass2');
    const meterBar = document.getElementById('meterBar');
    const badgeToken = document.getElementById('badgeToken');
    const toastWrap = document.querySelector('.toast-wrap');

    function now(){ return Date.now(); }
    function setState(s){ localStorage.setItem(LS_KEY_REC, JSON.stringify(s)); }
    function getState(){ try{ return JSON.parse(localStorage.getItem(LS_KEY_REC)) || { token:null, exp:0, email:null }; } catch{ return { token:null, exp:0, email:null }; } }
    function randomToken(){ return Math.random().toString(36).slice(2) + Math.random().toString(36).slice(2); }
    function msLeft(){ const s = getState(); return Math.max(0, (s.exp||0) - now()); }
    function prettyCountdown(ms){ const sec = Math.ceil(ms/1000); const m = Math.floor(sec/60); const s = sec%60; return `${m}m ${String(s).padStart(2,'0')}s`; }

    function updateBadge(){
      const s = getState();
      if(s.token && msLeft()>0){ badgeToken.textContent = `Token activo · expira en ${prettyCountdown(msLeft())}`; }
      else if(s.token && msLeft()<=0){ badgeToken.textContent = 'Token expirado'; }
      else { badgeToken.textContent = 'Token: sin generar'; }
    }
    setInterval(updateBadge, 1000);

    function showError(name, show=true){
      const el = document.querySelector(`[data-error-for="${name}"]`);
      if(el) el.style.display = show ? 'block' : 'none';
    }
    function toast(msg, type='ok'){
      const t = document.createElement('div');
      t.className = 'toast'; t.textContent = msg;
      if(type==='err'){ t.style.background = '#991b1b'; }
      if(type==='warn'){ t.style.background = '#92400e'; }
      if(type==='ok'){ t.style.background = '#065f46'; }
      toastWrap.appendChild(t);
      requestAnimationFrame(()=> t.classList.add('show'));
      setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.remove(), 200); }, 3400);
    }

    function fuerza(pass){ let score=0; if(pass.length>=8) score++; if(/[A-Z]/.test(pass)) score++; if(/[0-9]/.test(pass)) score++; if(/[^A-Za-z0-9]/.test(pass)) score++; return score; }
    pass1 && pass1.addEventListener('input', ()=>{ const s = fuerza(pass1.value); const pct=[0,25,50,75,100][s]; meterBar.style.width = pct + '%'; meterBar.className = s<=1?'weak':(s===2?'mid':'strong'); });

    formSolicitud.addEventListener('submit', async (e)=>{
      e.preventDefault(); ['email'].forEach(n=>showError(n,false));
      const val = email.value.trim();
      if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(val)){ showError('email',true); toast('Revisa el correo ingresado.','warn'); return; }
      btnEnviar.disabled = true; btnEnviar.textContent = 'Enviando…';
      await new Promise(r=>setTimeout(r, 900));
      const token = randomToken(); const exp = now() + TOKEN_MIN*60*1000;
      setState({ token, exp, email: val }); updateBadge();
      toast('Enlace enviado a tu correo. Válido por 10 minutos.','ok');
      btnEnviar.disabled = false; btnEnviar.textContent = 'Enviar enlace';
    });

    document.getElementById('simEnviado').addEventListener('click', ()=> toast('Aviso mostrado: enlace enviado.','ok'));
    document.getElementById('abrirEnlace').addEventListener('click', ()=>{
      if(msLeft()<=0){ toast('El enlace ha expirado. Solicítalo nuevamente.','warn'); return; }
      document.getElementById('formCambio').scrollIntoView({behavior:'smooth'});
      toast('Enlace válido. Completa tu nueva contraseña.','ok');
    });
    document.getElementById('cancelarCorreo').addEventListener('click', ()=> toast('Se canceló la apertura del enlace.','warn'));
    document.getElementById('reenviar').addEventListener('click', ()=>{
      const s = getState();
      if(s.email){
        const token = randomToken(); const exp = now() + TOKEN_MIN*60*1000;
        setState({ token, exp, email: s.email }); updateBadge();
        toast('Se envió un nuevo enlace por 10 minutos.','ok');
      } else { toast('Primero solicita el enlace ingresando tu correo.','warn'); }
    });

    formCambio.addEventListener('submit', async (e)=>{
      e.preventDefault(); ['pass1','pass2'].forEach(n=>showError(n,false));
      if(msLeft()<=0){ toast('El enlace ha expirado. Solicítalo nuevamente.','warn'); return; }
      const p1 = pass1.value; const p2 = pass2.value; let ok=true;
      if(fuerza(p1) < 2){ showError('pass1',true); ok=false; }
      if(p1 !== p2){ showError('pass2',true); ok=false; }
      if(!ok){ toast('Revisa los campos marcados.','warn'); return; }
      const btn = document.getElementById('btnCambiar'); btn.disabled = true; btn.textContent = 'Guardando…';
      await new Promise(r=>setTimeout(r, 900));
      setState({ token:null, exp:0, email:getState().email }); updateBadge();
      btn.disabled = false; btn.textContent = 'Cambiar contraseña';
      toast('La contraseña ha sido cambiada con éxito.','ok');
      document.getElementById('volverLogin').scrollIntoView({behavior:'smooth'});
    });

    document.getElementById('volverLogin').addEventListener('click', ()=>{
      window.location.hash = '#ingresar';
      toast('Listo. Ahora puedes iniciar sesión con tu nueva contraseña.','ok');
    });

    document.getElementById('year').textContent = new Date().getFullYear();
    updateBadge();
  </script>
</body>
</html>
