<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chocoman√≠a ¬∑ B-06 Carrito de compras</title>
  <meta name="description" content="Carrito de compras con cantidades, eliminaci√≥n, totales y simulaci√≥n de escenarios.">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --gap:16px; --radius:14px; --shadow:0 8px 24px rgba(0,0,0,.08);
      --bg:#f6f7fb; --card:#ffffff; --ink:#111827; --muted:#6b7280; --brand:#7d3c98; --border:#e5e7eb; --accent:#a66cc4;
      --ok:#10b981; --warn:#f59e0b; --err:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
    a{color:var(--brand); text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:1140px; margin:0 auto; padding:20px}

    header.top{position:sticky; top:0; z-index:30; backdrop-filter:saturate(180%) blur(8px); background:rgba(246,247,251,.86); border-bottom:1px solid var(--border)}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700; font-size:1.15rem}
    .logo{width:36px; height:36px; border-radius:10px; background:linear-gradient(135deg,#522a7a,#aa6bc8); box-shadow:inset 0 0 0 2px rgba(255,255,255,.25)}
    nav ul{display:flex; gap:14px; list-style:none; margin:0; padding:0}
    nav a{padding:8px 12px; border-radius:999px}
    nav a:hover{background:#ece7f6}
    .btn{border:1px solid var(--border); background:#fff; border-radius:999px; padding:10px 14px; cursor:pointer}
    .btn.primary{background:var(--brand); color:#fff; border-color:transparent}
    .btn.ghost{background:transparent}
    .btn.small{padding:8px 12px}
    .icon-btn{border:1px solid var(--border); background:#fff; border-radius:10px; padding:8px 10px; cursor:pointer}

    .layout{display:grid; grid-template-columns:1fr; gap:20px; margin-top:18px}

    .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow)}
    .muted{color:var(--muted)}

    /* Cat√°logo demo */
    .grid-products{display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr))}
    .p-card{border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; display:flex; flex-direction:column; background:#fff}
    .p-thumb{
      width:100%;
      aspect-ratio: 4 / 3;
      border-bottom:1px solid #eee;
      background:#faf7ff;
      border-radius:14px 14px 0 0;
      overflow:hidden;
      display:grid; place-items:center;
    }
    .p-thumb img{
      width:100%; height:100%; display:block;
      object-fit: cover; object-position: center;
    }
    .p-name{font-weight:600; padding:10px 12px 0}
    .p-price{padding:0 12px 12px; color:#374151}
    .p-actions{display:flex; gap:8px; padding:0 12px 12px}

    /* Carrito */
    .cart-line{display:grid; grid-template-columns: 120px 1fr 190px; gap:16px; align-items:start; padding:12px; border:1px solid #e5e7eb; border-radius:14px; background:#fff}
    @media (max-width:800px){ .cart-line{ grid-template-columns: 100px 1fr } }
    .thumb{
      width:100%; aspect-ratio:4/3;
      border:1px dashed #d1d5db; border-radius:12px; background:#fafafa;
      display:grid; place-items:center; overflow:hidden; position:relative;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; border-radius:inherit; }
    .info{display:flex; flex-direction:column; gap:4px}
    .name{font-weight:700}
    .price{color:#444}
    .qty-panel{border:1px dashed #cfcfe6; border-radius:12px; padding:10px; display:flex; flex-direction:column; gap:10px}
    .qty{display:flex; align-items:center; justify-content:space-between; gap:8px; border:1px dashed #ddd; border-radius:10px; padding:6px 10px}
    .tools{display:flex; gap:8px; align-items:center; justify-content:space-between}
    .tools .remove{color:#991b1b}

    .summary{display:flex; flex-direction:column; gap:8px; margin-top:10px; align-items:flex-end}
    .summary .row{display:flex; gap:10px; align-items:center}
    .summary .total{font-weight:800; font-size:1.15rem}
    .cta{display:flex; justify-content:flex-end; margin-top:10px}

    /* Toast */
    .toast-wrap{position:fixed; top:18px; right:18px; display:grid; gap:10px; z-index:50}
    .toast{background:#111827; color:#fff; padding:12px 14px; border-radius:12px; box-shadow:var(--shadow); opacity:0; transform:translateY(-10px); transition:.25s}
    .toast.show{opacity:1; transform:translateY(0)}
  </style>
</head>
<body>
  <header class="top">
    <div class="container topbar">
      <div class="brand"><div class="logo" aria-hidden="true"></div> Chocoman√≠a</div>
      <nav aria-label="principal">
        <ul>
          <li><a href="#catalogo">Cat√°logo</a></li>
          <li><a href="#ofertas">Ofertas</a></li>
          <li><a href="#carrito" aria-current="page">Carrito</a></li>
          <li><a href="#ingresar">Ingresar</a></li>
        </ul>
      </nav>
      <div class="cta"><button class="btn primary" id="btnCheckoutTop" type="button">Finalizar y Comprar</button></div>
    </div>
  </header>

  <main class="container layout">
    <!-- Escenario 1: cat√°logo demo para agregar -->
    <section class="card" aria-labelledby="t-cat">
      <h2 id="t-cat">Agregar al carrito</h2>
      <div class="grid-products">
        <article class="p-card">
          <div class="p-thumb">
            <img src="IMG/ChocoDubai.png" alt="Chocolate Dubai" loading="lazy">
          </div>
          <div class="p-name">Chocolate Dubai</div>
          <div class="p-price">$5.000</div>
          <div class="p-actions">
            <button class="btn small add" data-id="p21" data-qty="1">Agregar al carrito</button>
          </div>
        </article>
        <article class="p-card">
          <div class="p-thumb">
            <img src="IMG/BombonesSurt.png" alt="Bombones surtidos 12u" loading="lazy">
          </div>
          <div class="p-name">Bombones surtidos 12u</div>
          <div class="p-price">$4.500</div>
          <div class="p-actions">
            <button class="btn small add" data-id="p02" data-qty="1">Agregar al carrito</button>
          </div>
        </article>
        <article class="p-card">
          <div class="p-thumb">
            <img src="IMG/Trufasamar.jpg" alt="Trufa de cacao amargo" loading="lazy">
          </div>
          <div class="p-name">Trufa de cacao amargo</div>
          <div class="p-price">$2.500</div>
          <div class="p-actions">
            <button class="btn small add" data-id="p03" data-qty="1">Agregar al carrito</button>
          </div>
        </article>
      </div>
    </section>

    <!-- Carrito din√°mico -->
    <section class="card" aria-labelledby="t-cart">
      <h2 id="t-cart">Carrito</h2>
      <div id="cart"></div>
      <div class="summary" id="summary" style="display:none">
        <div class="row"><span>Subtotal</span><strong id="sub"></strong></div>
        <div class="row"><span>Env√≠o</span><strong id="ship"></strong></div>
        <div class="row total"><span>Total</span><strong id="total"></strong></div>
        <div class="cta"><button class="btn primary" id="btnCheckout" type="button">Finalizar y Comprar</button></div>
      </div>
      <div id="empty" class="muted">Tu carrito est√° vac√≠o.</div>
    </section>

  

  <div class="toast-wrap" aria-live="polite" aria-atomic="true"></div>

  <footer class="container" style="margin:18px auto 24px; color:var(--muted); text-align:center">
    ¬© <span id="year"></span> Chocoman√≠a ¬∑ Carrito de compras
  </footer>

  <script>
    // --- Datos de ejemplo (alineados con Parte 4; ahora con imagen por producto) ---
    const PRODUCTS = [
      {id:'p21', name:'Chocolate Dubai',          price:5000, img:'IMG/ChocoDubai.png'},
      {id:'p02', name:'Bombones surtidos 12u',    price:4500, img:'IMG/BombonesSurt.png'},
      {id:'p03', name:'Trufa de cacao amargo',    price:2500, img:'IMG/Trufasamar.jpg'}
    ];

    const LS_CART = 'choco_cart';

    // Utils
    const $ = (sel)=> document.querySelector(sel);
    function toast(msg){ const t=document.createElement('div'); t.className='toast'; t.textContent=msg; document.querySelector('.toast-wrap').appendChild(t); requestAnimationFrame(()=>t.classList.add('show')); setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.remove(),200); }, 2600); }
    function currency(n){ return n.toLocaleString('es-CL',{style:'currency', currency:'CLP', maximumFractionDigits:0}); }

    function getCart(){ try{ return JSON.parse(localStorage.getItem(LS_CART)) || {}; } catch { return {}; } }
    function setCart(c){ localStorage.setItem(LS_CART, JSON.stringify(c)); renderCart(); }

    function findProd(id){ return PRODUCTS.find(p=>p.id===id); }

    function addToCart(id, qty=1){ const c=getCart(); c[id]=(c[id]||0)+qty; setCart(c); toast('Agregado al carrito üõí'); }
    function setQty(id, qty){ const c=getCart(); if(qty<=0){ delete c[id]; } else { c[id]=qty; } setCart(c); }
    function removeItem(id){ const c=getCart(); delete c[id]; setCart(c); toast('Producto eliminado'); }

    function renderCart(){
      const cart = getCart();
      const cont = $('#cart'); const empty=$('#empty'); const summary=$('#summary');
      cont.innerHTML='';
      const ids = Object.keys(cart);
      if(ids.length===0){ empty.style.display='block'; summary.style.display='none'; return; }
      empty.style.display='none'; summary.style.display='flex';

      let subtotal=0;
      ids.forEach(id=>{
        const p=findProd(id) || {id, name:'Producto', price:0, img:''};
        const qty = cart[id];
        subtotal += p.price * qty;

        const line = document.createElement('div'); line.className='cart-line';

        // Miniatura con imagen (o placeholder)
        const thumb = document.createElement('div'); thumb.className='thumb';
        if (p.img){
          const im = document.createElement('img');
          im.src = p.img; im.alt = p.name; im.loading = 'lazy'; im.decoding='async';
          thumb.appendChild(im);
        } else {
          thumb.textContent = 'Img';
          thumb.style.color = '#8f6aa6'; thumb.style.fontWeight='600';
        }

        const info = document.createElement('div'); info.className='info';
        const name = document.createElement('div'); name.className='name'; name.textContent='Producto: ' + p.name;
        const price = document.createElement('div'); price.className='price'; price.textContent='Precio producto: ' + currency(p.price);
        info.append(name, price);

        const panel = document.createElement('div'); panel.className='qty-panel';
        const qtyBox = document.createElement('div'); qtyBox.className='qty';
        const minus=document.createElement('button'); minus.type='button'; minus.className='icon-btn'; minus.textContent='‚àí';
        const val=document.createElement('strong'); val.textContent=String(qty);
        const plus=document.createElement('button'); plus.type='button'; plus.className='icon-btn'; plus.textContent='Ôºã';
        minus.addEventListener('click', ()=> setQty(id, Math.max(0, (getCart()[id]||0)-1)));
        plus.addEventListener('click', ()=> setQty(id, (getCart()[id]||0)+1));
        qtyBox.append(minus, val, plus);

        const tools=document.createElement('div'); tools.className='tools';
        const del=document.createElement('button'); del.type='button'; del.className='btn small remove'; del.textContent='üóë Eliminar';
        del.addEventListener('click', ()=> removeItem(id));
        tools.append(del);

        panel.append(qtyBox, tools);
        line.append(thumb, info, panel);
        cont.appendChild(line);
      });

      // Totales & env√≠o (demo): env√≠o $2.000 si subtotal < $15.000, gratis si no
      const envio = subtotal < 15000 && subtotal>0 ? 2000 : 0;
      $('#sub').textContent = currency(subtotal);
      $('#ship').textContent = envio===0? 'Gratis' : currency(envio);
      $('#total').textContent = currency(subtotal + envio);
    }

    // Listeners
    document.querySelectorAll('.add').forEach(b=> b.addEventListener('click', ()=> addToCart(b.dataset.id, parseInt(b.dataset.qty||'1',10)) ));

    // Simulaciones de escenarios
    document.getElementById('sim1').addEventListener('click', ()=>{ setCart({ p21:1 }); toast('Escenario 1 aplicado'); });
    document.getElementById('sim2').addEventListener('click', ()=>{ setCart({ p21:4 }); toast('Escenario 2 aplicado (cantidad 4)'); });
    document.getElementById('sim3').addEventListener('click', ()=>{ setCart({ p21:2, p02:1 }); toast('Escenario 3 aplicado (2 productos)'); });
    document.getElementById('vaciar').addEventListener('click', ()=>{ localStorage.removeItem(LS_CART); renderCart(); toast('Carrito vac√≠o'); });

    // Checkout
    function goCheckout(){ if(Object.keys(getCart()).length===0){ toast('Tu carrito est√° vac√≠o.'); return; } window.location.hash = '#checkout'; toast('Redirigiendo a pago‚Ä¶'); }
    document.getElementById('btnCheckout').addEventListener('click', goCheckout);
    document.getElementById('btnCheckoutTop').addEventListener('click', goCheckout);

    // Init
    renderCart();
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
