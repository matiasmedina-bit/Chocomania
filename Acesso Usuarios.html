<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chocoman√≠a ¬∑ B-02 Inicio de sesi√≥n</title>
  <meta name="description" content="Inicio de sesi√≥n de clientes Chocoman√≠a. Control de intentos fallidos y bloqueo temporal.">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --gap:16px; --radius:14px; --shadow:0 8px 24px rgba(0,0,0,.08);
      --bg:#f6f7fb; --card:#ffffff; --ink:#111827; --muted:#6b7280; --brand:#7d3c98; --border:#e5e7eb;
      --ok:#10b981; --warn:#f59e0b; --err:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
    a{color:var(--brand); text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:1140px; margin:0 auto; padding:20px}

    /* Header */
    header.top{position:sticky; top:0; z-index:30; backdrop-filter:saturate(180%) blur(8px); background:rgba(246,247,251,.86); border-bottom:1px solid var(--border)}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700; font-size:1.15rem}
    .logo{width:36px; height:36px; border-radius:10px; background:linear-gradient(135deg,#522a7a,#aa6bc8); box-shadow:inset 0 0 0 2px rgba(255,255,255,.25)}
    nav ul{display:flex; gap:14px; list-style:none; margin:0; padding:0}
    nav a{padding:8px 12px; border-radius:999px}
    nav a:hover{background:#ece7f6}
    .btn{border:1px solid var(--border); background:#fff; border-radius:999px; padding:10px 14px; cursor:pointer}
    .btn.primary{background:var(--brand); color:#fff; border-color:transparent}

    /* Hero */
    .hero{display:grid; grid-template-columns:1.05fr .95fr; gap:20px; align-items:center; margin-top:18px}
    @media (max-width: 900px){ .hero{grid-template-columns:1fr} .grid{grid-template-columns:1fr} }
    .panel{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px}
    .chip{display:inline-flex; gap:8px; align-items:center; font-size:.8rem; color:#6a5a75; background:#f3eafc; border:1px dashed #d2b9eb; padding:6px 10px; border-radius:999px}
    .hero-visual{min-height:220px; border-radius:var(--radius); position:relative; overflow:hidden; display:grid; place-items:center}
    .hero-visual::before{content:''; position:absolute; inset:0; background:radial-gradient(1000px 360px at 0% 0%, rgba(125,60,152,.16), transparent 60%), radial-gradient(900px 280px at 100% 90%, rgba(166,108,196,.12), transparent 60%), linear-gradient(120deg, rgba(255,255,255,.85), rgba(255,255,255,.6))}

    .hero-visual .img-slot{
      width:86%;
      aspect-ratio: 1 / 1;          
      border-radius:18px;
      overflow:hidden;              
      background:#fff;
      border:2px solid #ece3f6;
      box-shadow:var(--shadow);
      display:grid; place-items:center;
      position:relative;
    }
    .hero-visual .img-slot img{
      width:100%; height:100%;
      object-fit:cover;
      object-position:center;
      display:block; border-radius:inherit;
    }

    /* Main grid */
    .grid{display:grid; grid-template-columns:1.05fr .95fr; gap:20px; margin-top:20px}
    .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow)}
    .muted{color:var(--muted)}

    /* Form */
    form.form{display:flex; flex-direction:column; gap:14px}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .field{flex:1 1 240px; display:flex; flex-direction:column; gap:6px}
    .label{font-weight:600; font-size:.95rem}
    .control{display:flex; align-items:center; gap:8px}
    input[type="email"], input[type="password"], input[type="text"]{width:100%; padding:12px 12px; border:1px solid #d1d5db; border-radius:10px; background:#fafafa; outline:none}
    input:focus{border-color:#b48ad3; box-shadow:0 0 0 4px rgba(125,60,152,.12)}
    .hint{font-size:.85rem; color:var(--muted)}
    .error{font-size:.85rem; color:var(--err); display:none}
    .actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .inline{display:flex; gap:10px; align-items:center}
    .link{font-size:.95rem}
    .showpass{border:1px solid #d1d5db; background:#fff; border-radius:10px; padding:10px 12px; cursor:pointer}

    /* Estados */
    .estados{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:14px}
    .estado{border:1px dashed #c7b5d9; padding:14px; border-radius:12px; background:#fdfbff}

    /* Toast */
    .toast-wrap{position:fixed; top:18px; right:18px; display:grid; gap:10px; z-index:50}
    .toast{background:#111827; color:#fff; padding:12px 14px; border-radius:12px; box-shadow:var(--shadow); opacity:0; transform:translateY(-10px); transition:.25s}
    .toast.show{opacity:1; transform:translateY(0)}
    .badge{display:inline-flex; align-items:center; gap:6px; border-radius:999px; padding:4px 10px; font-size:.8rem; border:1px solid #e5e7eb}

    footer{margin:40px 0 20px; color:var(--muted); text-align:center}
  </style>
</head>
<body>
  <header class="top">
    <div class="container topbar">
      <div class="brand"><div class="logo" aria-hidden="true"></div> Chocoman√≠a</div>
      <nav aria-label="principal">
        <ul>
          <li><a href="Visualizaci√≥n Catalogo.html">Cat√°logo</a></li>
          <li><a href="Promociones.html">Ofertas</a></li>
          <li><a href="Armado.html">Carrito</a></li>
          <li><a href="Acesso Usuarios.html" aria-current="page">Ingresar</a></li>
        </ul>
      </nav>
      <button class="btn primary" type="button">Ver promociones</button>
    </div>
  </header>

  <div class="container hero">
    <div class="panel">
      <h1>Bienvenido de vuelta üëã</h1>
      <p class="muted">Protegemos tu cuenta con control de intentos y bloqueo temporal. Si olvidaste tu contrase√±a, puedes recuperarla en 1 minuto.</p>
      <div class="inline" style="margin-top:10px">
        <span class="badge" id="badgeIntentos">Intentos fallidos: 0/3</span>
        <span class="badge" id="badgeEstado">Estado: Activo</span>
      </div>
    </div>
    <div class="hero-visual panel" aria-label="Espacio para imagen de inicio">
      <div class="img-slot">
        <img src="IMG/Baner2.png" alt="Cacao y chocolates" loading="lazy" decoding="async">
      </div>
    </div>
  </div>

  <main class="container grid" id="login">
    <!-- IZQUIERDA: Formulario real -->
    <section class="card" aria-labelledby="t-form">
      <h2 id="t-form">Inicio de sesi√≥n</h2>
      <p class="muted" style="margin-top:0">Introduce tus credenciales para continuar.</p>

      <form class="form" id="formLogin" novalidate>
        <div class="field">
          <label class="label" for="email">Correo electr√≥nico</label>
          <input id="email" name="email" type="email" autocomplete="email" placeholder="luis@example.com" required />
          <span class="error" data-error-for="email">Ingresa un correo v√°lido.</span>
        </div>
        <div class="field">
          <label class="label" for="pass">Contrase√±a</label>
          <div class="control">
            <input id="pass" name="pass" type="password" autocomplete="current-password" placeholder="********" required />
            <button class="showpass" type="button" id="togglePass" aria-label="Mostrar u ocultar contrase√±a">üëÅ</button>
          </div>
          <span class="error" data-error-for="pass">Ingresa tu contrase√±a.</span>
        </div>

        <div class="inline" style="justify-content:space-between">
          <label class="inline" for="remember">
            <input type="checkbox" id="remember" /> Recordarme
          </label>
          <a class="link" href="Restablecimiento Contrase√±a.html" id="linkRecuperar">¬øOlvidaste tu contrase√±a?</a>
        </div>

        <div class="actions">
          <button class="btn primary" id="btnLogin" type="submit">Iniciar sesi√≥n</button>
          <button class="btn" type="reset">Limpiar</button>
        </div>
      </form>
    </section>

    <!-- DERECHA: Estados / Alertas seg√∫n wireframe -->
    <aside class="card" aria-labelledby="t-estados">
      <h2 id="t-estados">Estados & alertas</h2> 
      <div class="estados">
        <div class="estado">
          <h3>Alerta de seguridad</h3>
          <p>‚ÄúTienes 2 intentos fallidos. Si fallas de nuevo se bloquear√° temporalmente tu cuenta‚Äù.</p>
          <button class="btn" type="button" id="simAlerta">Aceptar</button>
        </div>
        <div class="estado">
          <h3>Bloqueo temporal</h3>
          <p>‚ÄúSu cuenta ha sido bloqueada temporalmente por 20 minutos‚Äù.</p>
          <button class="btn" type="button" id="simBloqueo">Aceptar</button>
        </div>
      </div>
    </aside>
  </main>

  <div class="toast-wrap" aria-live="polite" aria-atomic="true"></div>

  <footer>
    <div class="container">¬© <span id="year"></span> Chocoman√≠a ¬∑ Tu sesi√≥n segura nos importa</div>
  </footer>

  <script>
    const LS_KEY = 'chocomania_login';
    const MAX_INTENTOS = 3;
    const BLOQUEO_MIN = 20;

    const form = document.getElementById('formLogin');
    const email = document.getElementById('email');
    const pass  = document.getElementById('pass');
    const btn   = document.getElementById('btnLogin');
    const badgeIntentos = document.getElementById('badgeIntentos');
    const badgeEstado   = document.getElementById('badgeEstado');
    const toastWrap = document.querySelector('.toast-wrap');

    function now(){ return Date.now(); }
    function getState(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)) || { intentos:0, lockUntil:0, remember:false }; } catch{ return { intentos:0, lockUntil:0, remember:false }; } }
    function setState(s){ localStorage.setItem(LS_KEY, JSON.stringify(s)); }
    function msLeft(){ const s = getState(); return Math.max(0, (s.lockUntil || 0) - now()); }
    function prettyCountdown(ms){ const sec = Math.ceil(ms/1000); const m = Math.floor(sec/60); const s = sec%60; return `${m}m ${String(s).padStart(2,'0')}s`; }
    function updateBadges(){
      const s = getState();
      badgeIntentos.textContent = `Intentos fallidos: ${s.intentos}/${MAX_INTENTOS}`;
      const locked = msLeft() > 0;
      badgeEstado.textContent = locked ? `Estado: Bloqueado (${prettyCountdown(msLeft())})` : 'Estado: Activo';
      btn.disabled = locked;
    }
    function showError(name, show=true){ const el = document.querySelector(`[data-error-for="${name}"]`); if(el) el.style.display = show ? 'block' : 'none'; }
    function toast(msg, type='ok'){
      const t = document.createElement('div');
      t.className = 'toast'; t.textContent = msg;
      if(type==='err'){ t.style.background = '#991b1b'; }
      if(type==='warn'){ t.style.background = '#92400e'; }
      if(type==='ok'){ t.style.background = '#065f46'; }
      toastWrap.appendChild(t);
      requestAnimationFrame(()=> t.classList.add('show'));
      setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.remove(), 200); }, 3400);
    }
    document.getElementById('togglePass').addEventListener('click', ()=>{ pass.type = pass.type === 'password' ? 'text' : 'password'; });
    (function initRemember(){ const s = getState(); document.getElementById('remember').checked = !!s.remember; if(s.remember && s.email){ email.value = s.email; } })();
    setInterval(()=>{ const left = msLeft(); if(left <= 0){ const s = getState(); if(s.lockUntil){ s.lockUntil = 0; setState(s); } } updateBadges(); }, 1000);

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      ['email','pass'].forEach(n=>showError(n,false));
      if(msLeft() > 0){ toast('Tu cuenta est√° temporalmente bloqueada. Intenta m√°s tarde.', 'warn'); return; }
      let ok = true;
      const emailVal = email.value.trim();
      const passVal  = pass.value;
      if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(emailVal)){ showError('email',true); ok=false; }
      if(!passVal){ showError('pass',true); ok=false; }
      if(!ok){ toast('Revisa los campos marcados.', 'warn'); return; }

      btn.disabled = true; btn.textContent = 'Verificando‚Ä¶';
      await new Promise(r=>setTimeout(r, 900));

      const success = passVal === 'Chocolate123'; // demo
      const s = getState();
      if(success){
        toast('Inicio de sesi√≥n exitoso. ¬°Bienvenido/a! üç´', 'ok');
        s.intentos = 0;
        if(document.getElementById('remember').checked){ s.remember = true; s.email = emailVal; } else { s.remember = false; delete s.email; }
        setState(s);
        setTimeout(()=>{ window.location.hash = '#catalogo'; }, 600);
      } else {
        s.intentos = (s.intentos||0) + 1;
        if(s.intentos === 2){ toast('Tienes 2 intentos fallidos. Si fallas de nuevo se bloquear√° temporalmente tu cuenta.', 'warn'); }
        if(s.intentos >= MAX_INTENTOS){
          s.lockUntil = Date.now() + (BLOQUEO_MIN*60*1000);
          toast('Tu cuenta ha sido bloqueada temporalmente por 20 minutos.', 'err');
        } else {
          toast('Credenciales inv√°lidas. Int√©ntalo nuevamente.', 'warn');
        }
        setState(s);
      }
      btn.disabled = false; btn.textContent = 'Iniciar sesi√≥n';
      updateBadges();
    });

    document.getElementById('simAlerta').addEventListener('click', ()=>{ const s = getState(); s.intentos = 2; setState(s); updateBadges(); toast('Se forz√≥ el estado de alerta (2 intentos).', 'warn'); });
    document.getElementById('simBloqueo').addEventListener('click', ()=>{ const s = getState(); s.intentos = 3; s.lockUntil = Date.now() + (20*60*1000); setState(s); updateBadges(); toast('Se forz√≥ el bloqueo de 20 minutos.', 'err'); });
    document.getElementById('year').textContent = new Date().getFullYear();
    updateBadges();
  </script>
</body>
</html>
