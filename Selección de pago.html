<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chocomanía · B-09 Métodos de pago</title>
  <meta name="description" content="Selección de método de pago (Débito, Crédito con cuotas, Efectivo), resumen de compra y manejo de pago rechazado.">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --gap:16px; --radius:14px; --shadow:0 8px 24px rgba(0,0,0,.08);
      --bg:#f6f7fb; --card:#ffffff; --ink:#111827; --muted:#6b7280; --brand:#7d3c98; --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
    .container{max-width:1140px; margin:0 auto; padding:20px}

    header.top{position:sticky; top:0; z-index:30; backdrop-filter:saturate(180%) blur(8px); background:rgba(246,247,251,.86); border-bottom:1px solid var(--border)}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700; font-size:1.15rem}
    .logo{width:36px; height:36px; border-radius:10px; background:linear-gradient(135deg,#522a7a,#aa6bc8)}
    nav ul{display:flex; gap:14px; list-style:none; margin:0; padding:0}
    nav a{padding:8px 12px; border-radius:999px; text-decoration:none; color:inherit}
    .btn{border:1px solid var(--border); background:#fff; border-radius:999px; padding:10px 14px; cursor:pointer}
    .btn.primary{background:#7d3c98; color:#fff; border-color:transparent}
    .btn.ghost{background:transparent}
    .btn.small{padding:8px 12px}

    .layout{display:grid; grid-template-columns: 1fr; gap:20px; margin-top:18px}
    .card{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:18px; box-shadow:0 8px 24px rgba(0,0,0,.08)}

    /* Resumen carrito */
    .cart-line{display:grid; grid-template-columns: 120px 1fr 150px 170px; gap:16px; align-items:center; padding:12px; border:1px solid #e5e7eb; border-radius:14px; background:#fff}
    @media (max-width: 960px){ .cart-line{ grid-template-columns: 110px 1fr; } .cart-line .lprice{display:none} }
    .thumb{position:relative; width:100%; aspect-ratio:4/3; border:1px solid var(--border); border-radius:12px; overflow:hidden; background:#faf7ff}
    .thumb img{width:100%; height:100%; object-fit:cover; object-position:center; display:block}
    .badge-stock{display:inline-flex; gap:6px; align-items:center; padding:6px 10px; border:1px dashed #7aa97a; color:#2c6b2c; background:#f0f8f0; border-radius:999px; font-size:.85rem}
    .info{display:flex; flex-direction:column; gap:6px}
    .qty{display:flex; justify-content:center}
    .stepper{display:flex; align-items:center; gap:8px; border:1px dashed #bbb; border-radius:12px; padding:6px 10px}
    .stepper button{border:1px dashed #ccc; background:#fff; border-radius:8px; padding:4px 8px; cursor:pointer}
    .lprice{display:flex; justify-content:flex-end; gap:8px; font-weight:800}
    .totals{display:flex; justify-content:flex-end; gap:10px; font-weight:800}
    .cta{display:flex; justify-content:flex-end; margin-top:10px}

    /* Pago */
    .pay-wrap{display:grid; grid-template-columns: 1fr; gap:16px}
    .pay-title{font-size:1.25rem; font-weight:800; margin:0 0 8px}
    .pay-grid{display:grid; grid-template-columns: repeat(auto-fit, minmax(160px,1fr)); gap:10px}
    .pay-option{display:flex; align-items:center; justify-content:center; gap:12px; padding:12px; border:1px dashed #bbb; border-radius:12px; background:#fafafa; cursor:pointer}
    .pay-option.active{background:#eaf2ff; border-color:#7aa3ff}
    .amount{text-align:center; font-weight:800; margin-top:6px}
    .installments{border:1px dashed #bbb; border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:8px}
    .radio-list{display:flex; flex-direction:column; gap:6px}
    .mini{font-size:.9rem; color:#555}

    /* Modal rechazo */
    dialog{border:none; padding:0; background:transparent}
    .modal{border:2px dashed #c77; background:#fff8f8; border-radius:12px; padding:16px; width:min(420px, 92vw); box-shadow:0 8px 24px rgba(0,0,0,.08)}
    .modal .actions{display:flex; justify-content:center; gap:8px; margin-top:10px}

    /* Micro-animación */
    .changed{animation:flash .6s ease}
    @keyframes flash{0%{background:#fff6cc}100%{background:transparent}}

    /* Toast */
    .toast-wrap{position:fixed; top:18px; right:18px; display:grid; gap:10px; z-index:50}
    .toast{background:#111827; color:#fff; padding:12px 14px; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.08); opacity:0; transform:translateY(-10px); transition:.25s}
    .toast.show{opacity:1; transform:translateY(0)}
  </style>
</head>
<body>
  <header class="top">
    <div class="container topbar">
      <div class="brand"><div class="logo" aria-hidden="true"></div> Chocomanía</div>
      <nav aria-label="principal">
        <ul>
          <li><a href="Visualización Catalogo.html">Catálogo</a></li>
          <li><a href="Promociones.html">Ofertas</a></li>
          <li><a href="Armado.html">Carrito</a></li>
          <li><a href="Acesso Usuarios.html">Ingresar</a></li>
        </ul>
      </nav>
      <div class="cta"><button class="btn primary" id="btnPayTop" type="button">Finalizar y Comprar</button></div>
    </div>
  </header>

  <main class="container layout">
    <!-- Resumen del carrito -->
    <section class="card">
      <h2>Resumen de tu carrito</h2>

      <div class="cart-line" id="row1">
        <div class="thumb">
          <img src="IMG/ChocoDubai.png" alt="Chocolate Dubai" loading="lazy">
        </div>
        <div class="info">
          <span class="badge-stock">✔ Stock disponible</span>
          <div><strong>Producto:</strong> Chocolate Dubai</div>
          <div><strong>Precio producto:</strong> <span id="p1price">$5.000</span></div>
        </div>
        <div class="qty">
          <div class="stepper">
            <button id="p1m" aria-label="Restar 1">−</button>
            <strong id="p1qty">1</strong>
            <button id="p1p" aria-label="Sumar 1">＋</button>
          </div>
        </div>
        <div class="lprice">TOTAL: <span id="line1">$5.000</span></div>
      </div>

      <div class="cart-line" style="margin-top:10px" id="row2">
        <div class="thumb">
          <img src="IMG/BombonesSurt.png" alt="Bombones surtidos" loading="lazy">
        </div>
        <div class="info">
          <span class="badge-stock">✔ Stock disponible</span>
          <div><strong>Producto:</strong> Bombones surtidos</div>
          <div><strong>Precio producto:</strong> <span id="p2price">$4.500</span></div>
        </div>
        <div class="qty">
          <div class="stepper">
            <button id="p2m" aria-label="Restar 1">−</button>
            <strong id="p2qty">1</strong>
            <button id="p2p" aria-label="Sumar 1">＋</button>
          </div>
        </div>
        <div class="lprice"><span></span></div>
      </div>

      <div class="totals" style="margin-top:10px">MONTO TOTAL: <span id="grand">$9.500</span></div>
      <div class="cta"><button class="btn" id="btnPay1" type="button">Finalizar y Comprar</button></div>
    </section>

    <!-- Selección de método de pago -->
    <section class="card pay-wrap">
      <h3 class="pay-title">Selecciona tu método de pago</h3>
      <div class="pay-grid">
        <button class="pay-option active" data-method="debit" type="button">Débito</button>
        <button class="pay-option" data-method="credit" type="button">Crédito</button>
        <button class="pay-option" data-method="cash" type="button">Efectivo</button>
      </div>

      <!-- Cuotas (Crédito) -->
      <div id="installments" class="installments" style="display:none">
        <strong>Cuotas (0% interés)</strong>
        <div class="radio-list" id="cuotasList">
          <label><input type="radio" name="cuotas" value="1" checked> 1 cuota — <span class="mini" id="c1">$9.500</span></label>
          <label><input type="radio" name="cuotas" value="3"> 3 cuotas — <span class="mini" id="c3">$3.167 c/u</span></label>
          <label><input type="radio" name="cuotas" value="6"> 6 cuotas — <span class="mini" id="c6">$1.583 c/u</span></label>
          <label><input type="radio" name="cuotas" value="12"> 12 cuotas — <span class="mini" id="c12">$792 c/u</span></label>
        </div>
        <p class="mini">Valores referenciales (redondeados).</p>
      </div>

      <!-- Efectivo -->
      <div id="cashInfo" class="card" style="display:none; padding:12px">
        <strong>Instrucciones para efectivo</strong>
        <p class="mini" style="margin:6px 0 0">Paga al recibir en tienda o contraentrega.</p>
      </div>

      <div class="amount">MONTO A PAGAR: <span id="toPay">$9.500</span></div>
      <div class="cta" style="gap:8px; flex-wrap:wrap">
        <button class="btn ghost" id="btnReject" type="button">Simular rechazo</button>
        <button class="btn primary" id="btnPay2" type="button">Pagar ahora</button>
      </div>
    </section>
  </main>

  <!-- Modal: pago rechazado -->
  <dialog id="rejectDlg">
    <div class="modal" role="alertdialog" aria-labelledby="rejTitle" aria-describedby="rejDesc">
      <h3 id="rejTitle">Pago rechazado</h3>
      <p id="rejDesc">Su pago ha sido rechazado, inténtelo nuevamente.</p>
      <div class="actions">
        <button class="btn" id="dlgClose" type="button">Aceptar</button>
      </div>
    </div>
  </dialog>

  <div class="toast-wrap" aria-live="polite" aria-atomic="true"></div>

  <footer class="container" style="margin:18px auto 24px; color:#6b7280; text-align:center">
    © <span id="year"></span> Chocomanía · Métodos de pago
  </footer>

  <script>
    // ==== Utilidades / estado ====
    const LS_CART = 'choco_cart';
    const ID_DUBAI = 'p11', ID_BOMB = 'p02';
    const PRICE = { [ID_DUBAI]: 5000, [ID_BOMB]: 4500 };

    const $ = (s)=> document.querySelector(s);
    function currency(n){ return n.toLocaleString('es-CL', {style:'currency', currency:'CLP', maximumFractionDigits:0}); }
    function toast(msg){ const t=document.createElement('div'); t.className='toast'; t.textContent=msg; document.querySelector('.toast-wrap').appendChild(t); requestAnimationFrame(()=>t.classList.add('show')); setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.remove(),200); }, 2400); }
    function flash(el){ if(!el) return; el.classList.remove('changed'); void el.offsetWidth; el.classList.add('changed'); }

    function loadCart(){ try{ return JSON.parse(localStorage.getItem(LS_CART)) || {}; }catch{ return {}; } }
    function saveCart(c){ localStorage.setItem(LS_CART, JSON.stringify(c)); }

    const cart = loadCart();
    let q1 = Math.max(1, cart[ID_DUBAI] || 1);
    let q2 = Math.max(1, cart[ID_BOMB]  || 1);

    function paint(){
      $('#p1price').textContent = currency(PRICE[ID_DUBAI]);
      $('#p2price').textContent = currency(PRICE[ID_BOMB]);
      $('#p1qty').textContent = q1;
      $('#p2qty').textContent = q2;
      $('#line1').textContent = currency(q1*PRICE[ID_DUBAI]);
      const total = q1*PRICE[ID_DUBAI] + q2*PRICE[ID_BOMB];
      $('#grand').textContent = currency(total);
      $('#toPay').textContent = currency(total);
      // cuotas
      $('#c1').textContent  = currency(total);
      $('#c3').textContent  = currency(Math.round(total/3));
      $('#c6').textContent  = currency(Math.round(total/6));
      $('#c12').textContent = currency(Math.round(total/12));
      [$('#line1'), $('#grand'), $('#toPay')].forEach(flash);
    }

    function updateCart(){ const c=loadCart(); c[ID_DUBAI]=q1; c[ID_BOMB]=q2; saveCart(c); }

    // Steppers
    document.getElementById('p1m').addEventListener('click', ()=>{ q1=Math.max(1,q1-1); updateCart(); paint(); });
    document.getElementById('p1p').addEventListener('click', ()=>{ q1=Math.min(99,q1+1); updateCart(); paint(); });
    document.getElementById('p2m').addEventListener('click', ()=>{ q2=Math.max(1,q2-1); updateCart(); paint(); });
    document.getElementById('p2p').addEventListener('click', ()=>{ q2=Math.min(99,q2+1); updateCart(); paint(); });

    // Métodos de pago
    const options = document.querySelectorAll('.pay-option');
    let method = 'debit';
    options.forEach(btn=> btn.addEventListener('click', ()=>{
      options.forEach(b=> b.classList.remove('active'));
      btn.classList.add('active');
      method = btn.dataset.method;
      document.getElementById('installments').style.display = method==='credit' ? 'block' : 'none';
      document.getElementById('cashInfo').style.display     = method==='cash'   ? 'block' : 'none';
      toast('Método: ' + (method==='debit'?'Débito':method==='credit'?'Crédito':'Efectivo'));
    }));

    // Pago simulado
    function doPay(){
      const payBtn = document.getElementById('btnPay2'); payBtn.disabled=true; payBtn.textContent='Procesando…';
      setTimeout(()=>{ payBtn.disabled=false; payBtn.textContent='Pagar ahora'; toast('Pago aprobado ✅'); window.location.hash='#paid'; }, 900);
    }
    function reject(){ document.getElementById('rejectDlg').showModal(); }

    document.getElementById('btnPayTop').addEventListener('click', doPay);
    document.getElementById('btnPay1').addEventListener('click', doPay);
    document.getElementById('btnPay2').addEventListener('click', doPay);
    document.getElementById('btnReject').addEventListener('click', reject);
    document.getElementById('dlgClose').addEventListener('click', ()=> document.getElementById('rejectDlg').close());

    paint();
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
